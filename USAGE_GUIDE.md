# 📖 使用指南

## 🎯 概述

本指南详细介绍如何使用日语 Anki 卡片生成器的各种功能，从基础使用到高级技巧，帮助你充分利用这个强大的学习工具。

## 🚀 快速开始

### 1. 环境准备

#### 系统要求
- **操作系统**：Windows、macOS、Linux
- **Rust 版本**：1.70 或更高
- **网络连接**：用于 API 调用
- **磁盘空间**：至少 100MB 可用空间

#### 安装 Rust
```bash
# 安装 Rust（如果尚未安装）
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# 验证安装
rustc --version
cargo --version
```

### 2. 项目设置

```bash
# 克隆项目
git clone <your-repo-url>
cd anki-creator

# 编译项目
cargo build --release

# 复制配置文件
cp config.example config.toml
```

### 3. 配置 API 密钥

编辑 `config.toml` 文件：
```toml
[api]
openrouter_key = "your-actual-api-key-here"
```

### 4. 准备输入文件

将要分析的日语文本保存到 `input.txt`：
```text
今日は良い天気ですね。一緒に散歩に行きましょう。
新しいレストランを見つけました。とても美味しそうです。
```

### 5. 运行程序

```bash
cargo run
```

## 📋 功能详解

### 🎌 主菜单

程序启动后显示以下菜单：

```
🎌 日语 Anki 卡片生成器
请选择功能：
1. 解析单词        - 从文本中提取并分析单词
2. 解析语法        - 从文本中提取并分析语法点
3. 更新所有单词词性 - 重新分析数据库中所有单词的词性
4. 重新生成卡片文件 - 从数据库重新生成 Anki 导入文件
5. 更新所有单词解析 - 重新分析数据库中所有单词的详细内容
6. 根据ID更新单词解析 - 更新指定ID的单词解析
0. 退出程序
请输入选项 (0-6):
```

### 1️⃣ 解析单词

**功能**：从输入文本中提取日语单词，生成详细的单词卡片。

**使用步骤**：
1. 选择菜单选项 `1`
2. 程序自动读取 `input.txt` 文件
3. 显示文件预览和统计信息
4. 开始分析处理
5. 显示处理进度
6. 生成输出文件

**输出文件**：
- `japanese_words.csv` - 单词卡片
- `anki_cards.db` - SQLite 数据库

**示例输出**：
```csv
id,word,kana,analysis
1,"今日","きょう","## 日语单词分析：今日 (きょう)\n\n### 1. 详细的中文解释\n「今日 (きょう)」是一个日语单词，指代说话时所在的这一天...\n\n### 2. 词性\n**名词**\n\n### 3. 用法说明和语境\n常用于日常对话、书面语、新闻报道等各种场合...\n\n### 4. 常见搭配和例句\n- 今日は良い天気ですね (今天天气真好啊)\n- 今日中に (在今天之内)\n\n### 5. 相关词汇和变形\n- 今朝 (けさ) - 今天早上\n- 今夜 (こんや) - 今晚"
```

**适用场景**：
- 📚 学习新单词
- 📖 阅读文章后的词汇整理
- 🎯 针对性词汇学习
- 📝 制作单词卡片

### 2️⃣ 解析语法

**功能**：从输入文本中提取日语语法点，生成详细的语法卡片。

**使用步骤**：
1. 选择菜单选项 `2`
2. 程序自动读取 `input.txt` 文件
3. 显示文件预览和统计信息
4. 开始分析处理
5. 显示处理进度
6. 生成输出文件

**输出文件**：
- `japanese_grammar.csv` - 语法卡片
- `anki_cards.db` - SQLite 数据库

**示例输出**：
```csv
id,grammar,kana,analysis
1,"ましょう","ましょう","## 日语语法分析：ましょう\n\n### 1. 语法功能\n表示邀请、建议或意志的语法形式...\n\n### 2. 接续方式\n动词ます形 + ましょう\n\n### 3. 使用场景\n- 邀请他人一起做某事\n- 表达自己的意志\n- 礼貌的建议\n\n### 4. 例句\n- 一緒に行きましょう (一起去吧)\n- 頑張りましょう (加油吧)\n\n### 5. 相似语法区别\n- ましょう vs ましょうか\n- ましょう vs ます"
```

**适用场景**：
- 📖 语法学习
- 🎯 语法点整理
- 📝 语法卡片制作
- 🔍 语法分析练习

### 3️⃣ 更新所有单词词性

**功能**：重新分析数据库中所有单词的词性标注。

**使用步骤**：
1. 选择菜单选项 `3`
2. 程序显示数据库中的单词数量
3. 开始批量更新词性
4. 显示处理进度
5. 完成后询问是否重新生成卡片

**处理流程**：
```
🔄 开始更新所有单词的词性...
📊 找到 150 个单词需要更新词性
⏳ 处理进度: [████████████████████] 100% (150/150)
✅ 词性更新完成

是否重新生成卡片文件？(y/N):
```

**适用场景**：
- 🔄 词性标注不准确时
- 📊 批量修正词性信息
- 🎯 提高卡片质量
- 🔍 数据质量检查

### 4️⃣ 重新生成卡片文件

**功能**：从数据库重新生成 Anki 导入文件。

**使用步骤**：
1. 选择菜单选项 `4`
2. 程序从数据库读取所有数据
3. 重新生成 CSV 文件
4. 显示生成结果

**输出文件**：
- `japanese_words.csv` - 单词卡片
- `japanese_grammar.csv` - 语法卡片

**适用场景**：
- 📄 文件损坏或丢失时
- 🔄 修改输出格式后
- 📊 数据更新后重新导出
- 🎯 批量导出所有数据

### 5️⃣ 更新所有单词解析

**功能**：重新分析数据库中所有单词的详细内容。

**使用步骤**：
1. 选择菜单选项 `5`
2. 程序显示数据库中的单词数量
3. 开始批量更新解析
4. 显示处理进度
5. 完成后询问是否重新生成卡片

**处理流程**：
```
🔄 开始更新所有单词解析功能...
📊 找到 150 个单词需要更新解析
⏳ 处理进度: [████████████████████] 100% (150/150)
✅ 所有单词解析更新完成

是否重新生成卡片文件？(y/N):
```

**适用场景**：
- 🔄 解析内容不完整时
- 📊 批量提升解析质量
- 🎯 更新解析格式
- 🔍 内容质量检查

### 6️⃣ 根据ID更新单词解析

**功能**：更新指定ID的单词解析。

**使用步骤**：
1. 选择菜单选项 `6`
2. 输入要更新的单词ID
3. 程序查找并更新该单词
4. 显示更新结果
5. 询问是否重新生成卡片

**示例交互**：
```
🔄 根据ID更新单词解析功能...
请输入要更新的单词ID: 42
🔍 找到单词: 行く (いく)
⏳ 正在更新解析...
✅ 单词解析更新完成

是否重新生成卡片文件？(y/N):
```

**适用场景**：
- 🎯 修正特定单词的解析
- 🔍 个别单词质量提升
- 📝 精确更新内容
- 🛠️ 调试和测试

## 📊 处理流程详解

### 🔄 分析流程

#### 第一步：文本预处理
```
📖 读取输入文件: input.txt
✅ 文件读取成功，内容长度: 156 字符
📝 文本预览: 今日は良い天気ですね。一緒に散歩に行きましょう...
```

#### 第二步：信息提取
```
🔍 开始提取单词和语法信息...
⏳ 调用 AI 分析文本...
✅ 提取完成: 找到 8 个单词, 3 个语法点
```

#### 第三步：并发分析
```
🚀 开始并发分析处理...
📊 并发数: 20, 总条目: 11
⏳ 处理进度: [████████████████████] 100% (11/11)
⏱️ 总耗时: 15.3 秒
```

#### 第四步：数据存储
```
💾 保存到数据库...
✅ 单词保存: 8 条记录
✅ 语法保存: 3 条记录
```

#### 第五步：文件生成
```
📄 生成 CSV 文件...
✅ 单词卡片: japanese_words.csv
✅ 语法卡片: japanese_grammar.csv
```

### 📈 性能监控

#### 处理统计
```
📊 处理统计:
   - 总条目数: 11
   - 成功处理: 11
   - 失败条目: 0
   - 平均耗时: 1.4 秒/条目
   - API 调用: 12 次
   - 总耗时: 15.3 秒
```

#### 错误处理
```
❌ 处理错误: API 请求失败
🔄 自动重试: 第 2 次尝试
✅ 重试成功: 条目处理完成
```

## 🎯 使用技巧

### 💡 最佳实践

#### 1. 文本准备
- **长度控制**：单次处理 100-500 字符效果最佳
- **内容质量**：使用标准日语文本，避免方言或特殊表达
- **格式规范**：使用 UTF-8 编码，避免特殊字符

#### 2. 批量处理
- **分批处理**：大量文本分批处理，避免超时
- **进度保存**：定期保存数据库，防止数据丢失
- **错误恢复**：处理失败时使用重试功能

#### 3. 质量控制
- **定期更新**：定期更新词性和解析内容
- **人工检查**：重要内容建议人工检查
- **版本管理**：保留不同版本的数据文件

### 🔧 高级技巧

#### 1. 自定义配置
```toml
# 高性能配置
[processing]
concurrent_requests = 30
request_delay_ms = 50
max_retries = 2
request_timeout_seconds = 120

# 稳定配置
[processing]
concurrent_requests = 10
request_delay_ms = 200
max_retries = 5
request_timeout_seconds = 300
```

#### 2. 批量处理脚本
```bash
#!/bin/bash
# 批量处理多个文件

for file in input_*.txt; do
    echo "处理文件: $file"
    cp "$file" input.txt
    cargo run --bin anki-creator
    mv japanese_words.csv "words_${file%.txt}.csv"
    mv japanese_grammar.csv "grammar_${file%.txt}.csv"
done
```

#### 3. 数据库管理
```sql
-- 查看单词统计
SELECT COUNT(*) as total_words FROM words;

-- 查看语法统计
SELECT COUNT(*) as total_grammar FROM grammar;

-- 查看最近添加的内容
SELECT * FROM words ORDER BY created_at DESC LIMIT 10;
```

## 🚨 故障排除

### 常见问题

#### 1. 配置文件错误
```
❌ 错误: 配置文件加载失败
✅ 解决: 检查 config.toml 文件是否存在且格式正确
```

#### 2. API 密钥问题
```
❌ 错误: API key not found
✅ 解决: 检查 openrouter_key 配置项
```

#### 3. 网络连接问题
```
❌ 错误: Connection timeout
✅ 解决: 检查网络连接，增加超时时间
```

#### 4. 文件权限问题
```
❌ 错误: Permission denied
✅ 解决: 检查文件读写权限
```

#### 5. 数据库锁定
```
❌ 错误: Database locked
✅ 解决: 确保没有其他程序在使用数据库
```

### 调试技巧

#### 1. 启用详细日志
```bash
# 设置环境变量
export RUST_LOG=debug
cargo run
```

#### 2. 检查配置文件
```bash
# 验证 TOML 语法
toml-cli validate config.toml
```

#### 3. 测试 API 连接
```bash
# 测试 API 密钥
curl -H "Authorization: Bearer $OPENROUTER_API_KEY" \
     https://openrouter.ai/api/v1/models
```

#### 4. 检查数据库
```bash
# 使用 SQLite 命令行工具
sqlite3 anki_cards.db
.tables
.schema words
```

## 📚 学习建议

### 🎯 学习策略

#### 1. 循序渐进
- 从简单文本开始
- 逐步增加复杂度
- 定期复习已学内容

#### 2. 分类学习
- 按主题分类（日常、商务、学术）
- 按难度分级（初级、中级、高级）
- 按词性分类（名词、动词、形容词）

#### 3. 实践应用
- 制作个性化卡片
- 结合 Anki 间隔重复
- 实际使用学到的词汇

### 📊 学习效果评估

#### 1. 数量统计
- 总学习单词数
- 总学习语法点数
- 学习进度跟踪

#### 2. 质量评估
- 解析完整性
- 例句相关性
- 音调准确性

#### 3. 使用效果
- Anki 复习效率
- 实际应用能力
- 学习满意度

## 🔄 更新和维护

### 定期维护

#### 1. 数据备份
```bash
# 备份数据库
cp anki_cards.db anki_cards_backup_$(date +%Y%m%d).db

# 备份配置文件
cp config.toml config_backup_$(date +%Y%m%d).toml
```

#### 2. 内容更新
- 定期更新词性标注
- 完善解析内容
- 添加新的例句

#### 3. 性能优化
- 调整并发参数
- 优化网络配置
- 清理临时文件

### 版本升级

#### 1. 备份数据
```bash
# 备份所有重要文件
tar -czf backup_$(date +%Y%m%d).tar.gz \
    anki_cards.db config.toml *.csv
```

#### 2. 更新程序
```bash
# 拉取最新代码
git pull origin main

# 重新编译
cargo build --release
```

#### 3. 验证功能
- 测试基本功能
- 检查数据完整性
- 验证输出格式

## 📞 支持和帮助

### 获取帮助

#### 1. 查看日志
程序运行时会显示详细的处理信息，包括：
- 处理进度
- 错误信息
- 性能统计

#### 2. 检查文档
- README.md - 项目概述
- CONFIG_GUIDE.md - 配置说明
- PROJECT_STRUCTURE.md - 项目结构

#### 3. 社区支持
- GitHub Issues - 报告问题
- 讨论区 - 交流经验
- 文档贡献 - 改进文档

### 贡献指南

#### 1. 报告问题
- 详细描述问题
- 提供错误日志
- 说明复现步骤

#### 2. 功能建议
- 描述需求场景
- 提供使用案例
- 讨论实现方案

#### 3. 代码贡献
- 遵循代码规范
- 添加测试用例
- 更新相关文档

---

通过本指南，你应该能够充分利用日语 Anki 卡片生成器的各种功能。记住，学习是一个持续的过程，定期使用和维护这个工具将帮助你更好地掌握日语。
