# âš™ï¸ é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜äº† `config.toml` é…ç½®æ–‡ä»¶çš„å„ä¸ªé€‰é¡¹ï¼Œå¸®åŠ©ä½ æ ¹æ®éœ€æ±‚ä¼˜åŒ–ç¨‹åºæ€§èƒ½å’Œè¡Œä¸ºã€‚

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

- **é…ç½®æ–‡ä»¶**ï¼š`config.toml`
- **æ¨¡æ¿æ–‡ä»¶**ï¼š`config.example`
- **é»˜è®¤ä½ç½®**ï¼šé¡¹ç›®æ ¹ç›®å½•

## ğŸ”§ é…ç½®é¡¹è¯¦è§£

### ğŸŒ API é…ç½®

```toml
[api]
# OpenRouter API å¯†é’¥
openrouter_key = "sk-or-v1-your-api-key-here"
```

#### openrouter_key
- **ç±»å‹**ï¼šå­—ç¬¦ä¸²
- **å¿…éœ€**ï¼šæ˜¯
- **è¯´æ˜**ï¼šOpenRouter API å¯†é’¥ï¼Œç”¨äºè®¿é—® Google Gemini-2.5-Flash æ¨¡å‹
- **è·å–æ–¹å¼**ï¼š
  1. è®¿é—® [OpenRouter](https://openrouter.ai/)
  2. æ³¨å†Œè´¦å·å¹¶ç™»å½•
  3. åœ¨ API Keys é¡µé¢åˆ›å»ºæ–°çš„å¯†é’¥
  4. å¤åˆ¶å¯†é’¥å¹¶ç²˜è´´åˆ°é…ç½®æ–‡ä»¶ä¸­

**å®‰å…¨æç¤º**ï¼š
- âš ï¸ ä¸è¦å°†åŒ…å«çœŸå® API å¯†é’¥çš„é…ç½®æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
- ğŸ”’ å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–ï¼š`export OPENROUTER_API_KEY=your_key`
- ğŸ›¡ï¸ å®šæœŸè½®æ¢ API å¯†é’¥ä»¥ç¡®ä¿å®‰å…¨

### ğŸš€ å¤„ç†é…ç½®

```toml
[processing]
# å¹¶å‘å¤„ç†æ•°é‡
concurrent_requests = 20
# è¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
request_delay_ms = 100
# æœ€å¤§é‡è¯•æ¬¡æ•°
max_retries = 3
# è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
request_timeout_seconds = 180
```

#### concurrent_requests
- **ç±»å‹**ï¼šæ•´æ•°
- **é»˜è®¤å€¼**ï¼š20
- **èŒƒå›´**ï¼š1-50
- **è¯´æ˜**ï¼šåŒæ—¶å¤„ç†çš„å¹¶å‘è¯·æ±‚æ•°é‡
- **å½±å“**ï¼š
  - æ•°å€¼è¶Šå¤§ï¼Œå¤„ç†é€Ÿåº¦è¶Šå¿«
  - æ•°å€¼è¿‡å¤§å¯èƒ½å¯¼è‡´ API é™åˆ¶æˆ–ç½‘ç»œæ‹¥å¡
  - å»ºè®®æ ¹æ®ç½‘ç»œçŠ¶å†µå’Œ API é™åˆ¶è°ƒæ•´

**æ¨èå€¼**ï¼š
- ğŸŒ æ…¢é€Ÿç½‘ç»œï¼š5-10
- ğŸš€ å¿«é€Ÿç½‘ç»œï¼š15-25
- âš¡ ä¼ä¸šç½‘ç»œï¼š20-30

#### request_delay_ms
- **ç±»å‹**ï¼šæ•´æ•°
- **é»˜è®¤å€¼**ï¼š100
- **èŒƒå›´**ï¼š50-1000
- **å•ä½**ï¼šæ¯«ç§’
- **è¯´æ˜**ï¼šè¯·æ±‚ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´
- **ä½œç”¨**ï¼š
  - é¿å…è§¦å‘ API é¢‘ç‡é™åˆ¶
  - å‡å°‘æœåŠ¡å™¨è´Ÿè½½
  - æé«˜è¯·æ±‚æˆåŠŸç‡

**æ¨èå€¼**ï¼š
- ğŸ†“ å…è´¹ APIï¼š200-500ms
- ğŸ’° ä»˜è´¹ APIï¼š50-200ms
- ğŸ¢ ä¼ä¸š APIï¼š100-300ms

#### max_retries
- **ç±»å‹**ï¼šæ•´æ•°
- **é»˜è®¤å€¼**ï¼š3
- **èŒƒå›´**ï¼š1-10
- **è¯´æ˜**ï¼šè¯·æ±‚å¤±è´¥æ—¶çš„æœ€å¤§é‡è¯•æ¬¡æ•°
- **é‡è¯•æ¡ä»¶**ï¼š
  - ç½‘ç»œè¶…æ—¶
  - æœåŠ¡å™¨é”™è¯¯ï¼ˆ5xxï¼‰
  - ä¸´æ—¶æ€§é”™è¯¯

**æ¨èå€¼**ï¼š
- ğŸŒ ç¨³å®šç½‘ç»œï¼š2-3
- ğŸ“¶ ä¸ç¨³å®šç½‘ç»œï¼š5-7
- ğŸ”„ é«˜å¯é æ€§éœ€æ±‚ï¼š3-5

#### request_timeout_seconds
- **ç±»å‹**ï¼šæ•´æ•°
- **é»˜è®¤å€¼**ï¼š180
- **èŒƒå›´**ï¼š30-600
- **å•ä½**ï¼šç§’
- **è¯´æ˜**ï¼šå•ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´
- **å½±å“**ï¼š
  - è¶…æ—¶æ—¶é—´è¿‡çŸ­å¯èƒ½å¯¼è‡´è¯·æ±‚å¤±è´¥
  - è¶…æ—¶æ—¶é—´è¿‡é•¿å¯èƒ½å¯¼è‡´ç¨‹åºå¡æ­»

**æ¨èå€¼**ï¼š
- ğŸš€ å¿«é€Ÿ APIï¼š60-120s
- ğŸŒ æ…¢é€Ÿ APIï¼š180-300s
- ğŸ”„ æ‰¹é‡å¤„ç†ï¼š120-240s

### ğŸ—„ï¸ æ•°æ®åº“é…ç½®

```toml
[database]
# æ•°æ®åº“æ–‡ä»¶å
db_file = "anki_cards.db"
```

#### db_file
- **ç±»å‹**ï¼šå­—ç¬¦ä¸²
- **é»˜è®¤å€¼**ï¼š`"anki_cards.db"`
- **è¯´æ˜**ï¼šSQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„
- **æ”¯æŒ**ï¼š
  - ç›¸å¯¹è·¯å¾„ï¼šç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•
  - ç»å¯¹è·¯å¾„ï¼šå®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
  - æ–‡ä»¶åï¼šåœ¨å½“å‰ç›®å½•åˆ›å»º

**ç¤ºä¾‹**ï¼š
```toml
# ç›¸å¯¹è·¯å¾„
db_file = "data/anki_cards.db"

# ç»å¯¹è·¯å¾„
db_file = "/home/user/anki_data/cards.db"

# æ–‡ä»¶åï¼ˆæ¨èï¼‰
db_file = "anki_cards.db"
```

### ğŸ“¥ è¾“å…¥é…ç½®

```toml
[input]
# è¾“å…¥æ–‡ä»¶è·¯å¾„
text_file = "input.txt"
```

#### text_file
- **ç±»å‹**ï¼šå­—ç¬¦ä¸²
- **é»˜è®¤å€¼**ï¼š`"input.txt"`
- **è¯´æ˜**ï¼šåŒ…å«æ—¥è¯­æ–‡æœ¬çš„è¾“å…¥æ–‡ä»¶è·¯å¾„
- **æ ¼å¼è¦æ±‚**ï¼š
  - çº¯æ–‡æœ¬æ–‡ä»¶ï¼ˆ.txtï¼‰
  - UTF-8 ç¼–ç 
  - æ”¯æŒæ¢è¡Œå’Œç‰¹æ®Šå­—ç¬¦

**ç¤ºä¾‹**ï¼š
```toml
# ç›¸å¯¹è·¯å¾„
text_file = "data/japanese_text.txt"

# ç»å¯¹è·¯å¾„
text_file = "/home/user/documents/lesson1.txt"

# æ–‡ä»¶åï¼ˆæ¨èï¼‰
text_file = "input.txt"
```

### ğŸ“¤ è¾“å‡ºé…ç½®

```toml
[output]
# è¾“å‡ºæ–‡ä»¶å
words_file = "japanese_words.csv"
grammar_file = "japanese_grammar.csv"
```

#### words_file
- **ç±»å‹**ï¼šå­—ç¬¦ä¸²
- **é»˜è®¤å€¼**ï¼š`"japanese_words.csv"`
- **è¯´æ˜**ï¼šå•è¯å¡ç‰‡çš„è¾“å‡º CSV æ–‡ä»¶è·¯å¾„
- **æ ¼å¼**ï¼šCSV æ ¼å¼ï¼ŒåŒ…å« id, word, kana, analysis å­—æ®µ

#### grammar_file
- **ç±»å‹**ï¼šå­—ç¬¦ä¸²
- **é»˜è®¤å€¼**ï¼š`"japanese_grammar.csv"`
- **è¯´æ˜**ï¼šè¯­æ³•å¡ç‰‡çš„è¾“å‡º CSV æ–‡ä»¶è·¯å¾„
- **æ ¼å¼**ï¼šCSV æ ¼å¼ï¼ŒåŒ…å« id, grammar, kana, analysis å­—æ®µ

## ğŸ¯ é…ç½®ä¼˜åŒ–å»ºè®®

### ğŸš€ æ€§èƒ½ä¼˜åŒ–

#### é«˜å¹¶å‘é…ç½®
```toml
[processing]
concurrent_requests = 30
request_delay_ms = 50
max_retries = 2
request_timeout_seconds = 120
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å¤§æ‰¹é‡æ–‡æœ¬å¤„ç†
- ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ
- ä»˜è´¹ API æœåŠ¡

#### ç¨³å®šä¼˜å…ˆé…ç½®
```toml
[processing]
concurrent_requests = 10
request_delay_ms = 200
max_retries = 5
request_timeout_seconds = 300
```

**é€‚ç”¨åœºæ™¯**ï¼š
- ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ
- å…è´¹ API æœåŠ¡
- å¯¹æˆåŠŸç‡è¦æ±‚é«˜

#### å¹³è¡¡é…ç½®ï¼ˆæ¨èï¼‰
```toml
[processing]
concurrent_requests = 20
request_delay_ms = 100
max_retries = 3
request_timeout_seconds = 180
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯
- ä¸­ç­‰è§„æ¨¡çš„æ–‡æœ¬å¤„ç†
- å¹³è¡¡é€Ÿåº¦å’Œç¨³å®šæ€§

### ğŸ”’ å®‰å…¨é…ç½®

#### ç¯å¢ƒå˜é‡è¦†ç›–
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export OPENROUTER_API_KEY="your-secret-key"

# é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦
[api]
openrouter_key = "your-api-key-here"
```

#### é…ç½®æ–‡ä»¶æƒé™
```bash
# è®¾ç½®é…ç½®æ–‡ä»¶æƒé™ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
chmod 600 config.toml

# æ£€æŸ¥æƒé™
ls -l config.toml
```

### ğŸ“Š ç›‘æ§é…ç½®

#### è°ƒè¯•æ¨¡å¼
```toml
[processing]
concurrent_requests = 5
request_delay_ms = 500
max_retries = 1
request_timeout_seconds = 60
```

**ç‰¹ç‚¹**ï¼š
- é™ä½å¹¶å‘æ•°ä¾¿äºè°ƒè¯•
- å¢åŠ å»¶è¿Ÿä¾¿äºè§‚å¯Ÿ
- å‡å°‘é‡è¯•æ¬¡æ•°å¿«é€Ÿå¤±è´¥

## ğŸ› ï¸ é…ç½®éªŒè¯

### è‡ªåŠ¨éªŒè¯
ç¨‹åºå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨éªŒè¯é…ç½®ï¼š
- âœ… æ£€æŸ¥å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨
- âœ… éªŒè¯æ•°å€¼èŒƒå›´æ˜¯å¦åˆç†
- âœ… ç¡®è®¤æ–‡ä»¶è·¯å¾„æ˜¯å¦æœ‰æ•ˆ
- âœ… æµ‹è¯• API å¯†é’¥æ˜¯å¦å¯ç”¨

### æ‰‹åŠ¨éªŒè¯
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
toml-cli validate config.toml

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -l config.toml

# æµ‹è¯• API è¿æ¥
curl -H "Authorization: Bearer $OPENROUTER_API_KEY" \
     https://openrouter.ai/api/v1/models
```

## ğŸ”„ é…ç½®æ›´æ–°

### çƒ­é‡è½½
ç¨‹åºæ”¯æŒé…ç½®çƒ­é‡è½½ï¼š
1. ä¿®æ”¹é…ç½®æ–‡ä»¶
2. ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹å˜åŒ–
3. é‡æ–°åŠ è½½é…ç½®ï¼ˆéƒ¨åˆ†åŠŸèƒ½ï¼‰

### é‡å¯ç”Ÿæ•ˆ
æŸäº›é…ç½®éœ€è¦é‡å¯ç¨‹åºï¼š
- API å¯†é’¥æ›´æ”¹
- æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ›´æ”¹
- è¾“å‡ºæ–‡ä»¶è·¯å¾„æ›´æ”¹

## ğŸ“ é…ç½®ç¤ºä¾‹

### å®Œæ•´é…ç½®ç¤ºä¾‹
```toml
# Anki Creator é…ç½®æ–‡ä»¶
# è¯·ä¿æŠ¤å¥½ä½ çš„APIå¯†é’¥ï¼Œä¸è¦å°†æ­¤æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ

[api]
# OpenRouter API å¯†é’¥
openrouter_key = "sk-or-v1-your-api-key-here"

[processing]
# å¹¶å‘å¤„ç†æ•°é‡ï¼ˆå»ºè®® 10-30ï¼‰
concurrent_requests = 20
# è¯·æ±‚é—´å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
request_delay_ms = 100
# æœ€å¤§é‡è¯•æ¬¡æ•°
max_retries = 3
# è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
request_timeout_seconds = 180

[database]
# æ•°æ®åº“æ–‡ä»¶å
db_file = "anki_cards.db"

[input]
# è¾“å…¥æ–‡ä»¶è·¯å¾„
text_file = "input.txt"

[output]
# è¾“å‡ºæ–‡ä»¶å
words_file = "japanese_words.csv"
grammar_file = "japanese_grammar.csv"
```

### å¼€å‘ç¯å¢ƒé…ç½®
```toml
[api]
openrouter_key = "sk-or-v1-dev-key"

[processing]
concurrent_requests = 5
request_delay_ms = 500
max_retries = 1
request_timeout_seconds = 60

[database]
db_file = "dev_anki_cards.db"

[input]
text_file = "test_input.txt"

[output]
words_file = "dev_words.csv"
grammar_file = "dev_grammar.csv"
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®
```toml
[api]
openrouter_key = "sk-or-v1-prod-key"

[processing]
concurrent_requests = 25
request_delay_ms = 80
max_retries = 3
request_timeout_seconds = 240

[database]
db_file = "/data/anki_cards.db"

[input]
text_file = "/data/input.txt"

[output]
words_file = "/data/japanese_words.csv"
grammar_file = "/data/japanese_grammar.csv"
```

## ğŸš¨ å¸¸è§é…ç½®é”™è¯¯

### 1. API å¯†é’¥é”™è¯¯
```
âŒ é”™è¯¯ï¼šAPI key not found
âœ… è§£å†³ï¼šæ£€æŸ¥ openrouter_key é…ç½®é¡¹
```

### 2. å¹¶å‘æ•°è¿‡é«˜
```
âŒ é”™è¯¯ï¼šToo many concurrent requests
âœ… è§£å†³ï¼šé™ä½ concurrent_requests å€¼
```

### 3. æ–‡ä»¶è·¯å¾„é”™è¯¯
```
âŒ é”™è¯¯ï¼šFile not found
âœ… è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
```

### 4. æƒé™é—®é¢˜
```
âŒ é”™è¯¯ï¼šPermission denied
âœ… è§£å†³ï¼šæ£€æŸ¥æ–‡ä»¶è¯»å†™æƒé™
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - é¡¹ç›®æ¦‚è¿°å’Œå¿«é€Ÿå¼€å§‹
- [PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md) - é¡¹ç›®ç»“æ„è¯´æ˜
- [USAGE_GUIDE.md](./USAGE_GUIDE.md) - è¯¦ç»†ä½¿ç”¨æŒ‡å—

---

é€šè¿‡åˆç†é…ç½®è¿™äº›é€‰é¡¹ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚ä¼˜åŒ–ç¨‹åºçš„æ€§èƒ½ã€ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚å»ºè®®ä»é»˜è®¤é…ç½®å¼€å§‹ï¼Œæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µé€æ­¥è°ƒæ•´ã€‚
