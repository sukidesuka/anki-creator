# 项目结构说明

## 📁 模块组织

项目已重构为模块化结构，提高了代码的可维护性和可读性：

### 📋 文件结构

```
src/
├── lib.rs          # 库入口文件，导出公共接口
├── main.rs         # 主程序入口，包含菜单系统
├── config.rs       # 配置文件处理
├── models.rs       # 数据结构定义
├── api.rs          # API客户端和请求处理
├── database.rs     # 数据库操作和卡片生成
└── analyzer.rs     # 核心分析逻辑
```

### 🔧 模块功能

#### `config.rs`
- 配置文件结构定义
- TOML配置文件加载
- 所有配置相关的类型

#### `models.rs`
- 数据结构定义（JapaneseWord, JapaneseGrammar等）
- 分析结果结构
- 数据传输对象

#### `api.rs`
- OpenRouter API客户端
- 请求/响应结构
- 重试机制和错误处理

#### `database.rs`
- 数据库连接和初始化
- 数据库操作（增删改查）
- Anki卡片文件生成

#### `analyzer.rs`
- 主要业务逻辑
- 文本分析和处理
- 单词和语法分析
- 词性更新功能

#### `main.rs`
- 用户界面和菜单系统
- 程序入口点
- 用户交互逻辑

### 🎯 主要功能

1. **读取文章并解析生成卡片** - 从文本文件读取内容，分析单词和语法，生成Anki卡片
2. **更新所有单词词性** - 重新分析数据库中所有单词的词性
3. **重新生成卡片文件** - 从数据库重新生成Anki导入文件

### 🔄 模块依赖关系

```
main.rs
  └── analyzer.rs (AnkiCreator)
      ├── api.rs (ApiClient)
      ├── database.rs (DatabaseManager)
      ├── config.rs (Config)
      └── models.rs (数据结构)
```

### 📝 使用方式

程序启动后会显示菜单，用户可以选择不同的功能：

- **选项 1**: 处理新文本，提取单词和语法
- **选项 2**: 更新现有单词的词性标注
- **选项 3**: 重新生成Anki卡片文件
- **选项 0**: 退出程序

### 🛠️ 扩展性

模块化设计使得以下扩展变得容易：

- 添加新的API提供商（修改 `api.rs`）
- 支持新的数据库类型（修改 `database.rs`）
- 添加新的分析功能（扩展 `analyzer.rs`）
- 修改用户界面（更新 `main.rs`）

这种结构遵循了Rust的最佳实践，每个模块都有明确的职责，降低了耦合度，提高了代码的可测试性和可维护性。
